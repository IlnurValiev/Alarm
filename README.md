Часы с будильником. Валиев Ильнур. Декабрь 2020.

Аппаратная часть.

В проекте используются: 3 кнопки; энкодер; семисегментный индикатор с общим катодом; пьезодинамик; 8 резисторов 10 Ом.

Часы редактируются нажатием на кнопку А5. При первом нажатии редактируются минуты(энкодером), втором часы, третье выходит из режима редактирования и далее аналогично. Так же о том, что выставлен режим изменения минут символизирует синий светодиод PC8, для часов желтый PC9.
Переход в режим выставления будильника осуществляется кнопкой B0. Но диоды при этом будут мигать - при выставлении минут синий, часов - желтый. Стоит отметить, что в режиме выставления будильника отсутствует дефолтное состояние, при котором мы не изменяем ничего. 
Включение и выключение будильника осуществляется кнопкой А7. Если он включен, загорается первая десятичная точка. Если выключен, она затухает. Кнопка так же отключает будильник после срабатывания.

Программная часть.
Переменная sec инкрементируется каждую секунду в таймере systick, в соответствии с ней получают значения min и hour. alarm_min и alarm_hour для будильника.
Флаг set_clock служит для распознавания текущего действия. -1 дефолт; 0 изменяем минуты, 1 часы, 2 минуты будильника, 3 часы будильника. 
counter для отсчета секунды, каждое срабатывание systick'a, т.е. каждую миллисекунду, инкрементируется до 1000, при нуле инкрементируется sec; counter_dp для отсчета двух секунду, чтобы пока он меньше 1000 третья точка горела, пока больше затухала, таким образом она будет гореть секунду, и столько же будет затухшей; counter_alarm служит чтобы диоды мигали при редактировании будильника, тем самым было внешнее отличие от изменения текущего времени.
Флаг alarm_on означает включенность и выключенность будильника; alarm_trigger выставляется при срабатывании будильника и служит для того, чтобы он звенел более минуты. Флаги сбрасываются в обработчике TIM14, который связана с кнпокой A7. Там же выставляется нулевой порог для ШИМа динамика, чтобы отключить динамик; заново тактируется TIM2, поскольку один его канал мы используем для кнопки А5, другой для ШИМа, который тактируется при срабатывании. 
Функция buzz тактирует и включает динамик B3 через 2 канал TIM2. timers_config_set_clock тактирует кнопку А5 через 1 канал TIM2. Стоит заметить, что кнопки я тактировал через TIM'ы, чтобы использовать системный фильтр дребезга, поскольку фильтрация в EXTI через захват времени у меня работает некорректно.
Основная часть работы происходит в обработчике systick. Инкрементируются флаги, секунды, проверяется срабатывание при выставленном флаге alarm_on и сравнивании часов минут будильника с системными. Звон будильника при выставленном флаге, повторюсь, он нужен, чтобы будильник звенел более минуты. Отображение текущего времени при флаге set_clock -1,0,1 и значения будильника при 2,3. Там же, если он равен 2(изменяем минуты), каждые полсекунды мигаем синим, если 3(изменяем часы), желтым. 
Остальные функции служат для тактирования контроллера, оставшихся кнопок, энкодера, GPIO, отображения числа на 7сег. индикаторе. В особых комментариях не нуждаются.
Дифайны пинов, функция их тактирования и некоторые функции по включению и отключению точки на 7сег. индикаторе написаны в заголовочнике main.h.      
